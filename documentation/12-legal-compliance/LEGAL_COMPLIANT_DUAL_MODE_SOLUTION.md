# Legal-Compliant Dual-Mode Solution - Final Implementation

**Date**: 2025-11-08
**Status**: LEGAL & PRACTICAL FINAL SOLUTION

---

## üéØ YOUR CRITICAL QUESTIONS

1. ‚úÖ **Workshop should control geographic restrictions** (not platform enforced for all)
2. ‚ö†Ô∏è **Workshop seeing mechanic's independent revenue = privacy concern**
3. ‚ö†Ô∏è **Account ownership = legal liability question**
4. ‚ö†Ô∏è **Canadian employment law compliance**
5. ‚ö†Ô∏è **Platform = broker only, zero liability**

---

## üèõÔ∏è LEGAL FRAMEWORK: PLATFORM AS BROKER ONLY

### **Core Principle:**

**Platform provides INFRASTRUCTURE, not employment.**

Just like:
- Uber: Connects riders with drivers (not employer)
- Airbnb: Connects guests with hosts (not landlord)
- Upwork: Connects clients with freelancers (not employer)

**AskAutoDoctor: Connects customers with mechanics/workshops (not employer)**

---

## üìã THE LEGAL-COMPLIANT MODEL

### **Three Separate Legal Relationships:**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                                                     ‚îÇ
‚îÇ  Customer ‚Üê‚Üí Platform ‚Üê‚Üí Mechanic/Workshop        ‚îÇ
‚îÇ                                                     ‚îÇ
‚îÇ  Platform = Broker/Marketplace                     ‚îÇ
‚îÇ  Platform does NOT employ mechanics                ‚îÇ
‚îÇ  Platform does NOT control work conditions         ‚îÇ
‚îÇ  Platform does NOT set wages                       ‚îÇ
‚îÇ                                                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

Relationship 1: Customer ‚Üê‚Üí Platform
  ‚Ä¢ Customer buys "access to expert advice"
  ‚Ä¢ Platform provides marketplace service
  ‚Ä¢ Platform takes 5% service fee

Relationship 2: Platform ‚Üê‚Üí Mechanic (Independent)
  ‚Ä¢ Mechanic is independent contractor
  ‚Ä¢ Mechanic sets own hours
  ‚Ä¢ Mechanic receives 95% of session fees
  ‚Ä¢ Platform issues T4A (contractor tax form)

Relationship 3: Workshop ‚Üê‚Üí Mechanic (Employment)
  ‚Ä¢ Workshop directly employs mechanic
  ‚Ä¢ Workshop sets hours, wage, conditions
  ‚Ä¢ Workshop issues T4 (employee tax form)
  ‚Ä¢ Platform NOT involved in this relationship

Relationship 4: Platform ‚Üê‚Üí Workshop
  ‚Ä¢ Workshop is independent business
  ‚Ä¢ Workshop can use platform as tool
  ‚Ä¢ Platform takes 5% service fee
  ‚Ä¢ No employment relationship
```

---

## üîê ACCOUNT OWNERSHIP & CONTROL

### **The Solution: Mechanics OWN Their Accounts, Always**

**Why?**
1. **Legal**: Independent contractors must own their tools/accounts
2. **Privacy**: Mechanics have right to financial privacy
3. **Liability**: Platform doesn't control mechanic = not employer
4. **Practical**: Mechanic can leave workshop, keep account

### **How It Works:**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ MECHANIC'S ACCOUNT (Owned by Mike Johnson)         ‚îÇ
‚îÇ                                                     ‚îÇ
‚îÇ Account Owner: Mike Johnson (Sole Control)         ‚îÇ
‚îÇ Email/Password: Mike's personal                    ‚îÇ
‚îÇ Stripe Account: Mike's personal                    ‚îÇ
‚îÇ SIN/Tax Info: Mike's personal                      ‚îÇ
‚îÇ                                                     ‚îÇ
‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  ‚îÇ
‚îÇ                                                     ‚îÇ
‚îÇ OPTIONAL: Workshop Integration                     ‚îÇ
‚îÇ                                                     ‚îÇ
‚îÇ Workshop: AutoFix (Invited, Mike Accepted)         ‚îÇ
‚îÇ Status: Active Employment                          ‚îÇ
‚îÇ Work Schedule: Mon-Fri 9am-5pm                     ‚îÇ
‚îÇ                                                     ‚îÇ
‚îÇ Revenue Routing (During Workshop Hours ONLY):      ‚îÇ
‚îÇ ‚Ä¢ Sessions 9am-5pm ‚Üí Workshop's Stripe Account     ‚îÇ
‚îÇ ‚Ä¢ Sessions after 5pm ‚Üí Mike's Stripe Account       ‚îÇ
‚îÇ                                                     ‚îÇ
‚îÇ Geographic Settings (Workshop's Choice):           ‚îÇ
‚îÇ ‚òê No restrictions (Workshop trusts Mike)           ‚îÇ
‚îÇ ‚òë Block Toronto 50km (Workshop protects territory)‚îÇ
‚îÇ                                                     ‚îÇ
‚îÇ Mike can DISCONNECT from workshop anytime          ‚îÇ
‚îÇ Workshop can REMOVE Mike anytime                   ‚îÇ
‚îÇ                                                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Key Points:**
- ‚úÖ Mike owns the account (not workshop)
- ‚úÖ Mike controls login credentials
- ‚úÖ Mike can disconnect from workshop
- ‚úÖ Workshop can remove Mike
- ‚úÖ No employment relationship with platform

---

## üí∞ REVENUE PRIVACY & WORKSHOP MONITORING

### **The Balance: Workshop Needs Info, Mechanic Needs Privacy**

**What Workshop CAN See (Legitimate Business Interest):**

```
Workshop Dashboard - Mike's Activity

WORKSHOP MODE SESSIONS (Your Business):
‚úÖ Number of sessions during work hours
‚úÖ Customer names/issues (your potential leads)
‚úÖ Session ratings/feedback
‚úÖ Total revenue generated FOR WORKSHOP
‚úÖ Time stamps

Example:
‚Ä¢ Monday 10:30am: John Smith - Brake noise ‚Üí $50 to workshop
‚Ä¢ Monday 2:15pm: Sarah Lee - Check engine ‚Üí $50 to workshop

Total workshop revenue from Mike: $100
```

**What Workshop CANNOT See (Privacy Protected):**

```
INDEPENDENT MODE SESSIONS (Mike's Private Business):

‚ùå Mike's independent revenue amounts
‚ùå Mike's independent customer details
‚ùå Mike's independent earnings

What workshop CAN see (for geographic verification only):
‚úÖ Number of independent sessions (count only)
‚úÖ Customer cities (for non-compete verification)
‚úÖ Whether violations occurred

Example:
Independent Activity (Privacy Mode):
‚Ä¢ Monday 7pm: 1 session - Customer in Ottawa ‚úÖ
‚Ä¢ Tuesday 8pm: 1 session - Customer in Montreal ‚úÖ
‚Ä¢ Wednesday 6pm: ‚ö†Ô∏è Customer in Toronto (BLOCKED - restriction active)

Total independent sessions: 2
Geographic violations: 0 ‚úÖ

Revenue details: HIDDEN (Mike's private business)
```

### **Why This Works:**

**Workshop's Legitimate Concerns Addressed:**
- ‚úÖ Can verify Mike isn't stealing local customers (sees cities only)
- ‚úÖ Can track productivity during work hours (sees full details)
- ‚úÖ Can ensure Mike honors agreement (sees violation alerts)

**Mechanic's Privacy Protected:**
- ‚úÖ Independent earnings private (workshop doesn't see amounts)
- ‚úÖ Independent customers private (workshop doesn't see names)
- ‚úÖ Platform respects contractor status (no employer surveillance)

---

## ü§ù THE LEGAL AGREEMENT STRUCTURE

### **Three Separate Agreements:**

**Agreement 1: Platform ‚Üê‚Üí Mechanic (Independent Contractor)**

```
INDEPENDENT CONTRACTOR AGREEMENT

1. Relationship
   You (Mike Johnson) are an INDEPENDENT CONTRACTOR, not employee.
   You control your own schedule, rates, and work methods.

2. Payment
   Platform pays you 95% of session fees via Stripe.
   Platform reports earnings to CRA via T4A.
   You are responsible for your own taxes.

3. Account Ownership
   You OWN your account. Platform cannot restrict your use
   except for policy violations (fraud, abuse, etc.).

4. Workshop Integration (Optional)
   You MAY choose to integrate with workshop(s).
   This does NOT create employment with Platform.
   Your agreement with workshop is separate.

5. Liability
   Platform is marketplace only. We do not guarantee work quality.
   You maintain own liability insurance.
```

**Agreement 2: Workshop ‚Üê‚Üí Mechanic (Employment Contract)**

```
EMPLOYMENT AGREEMENT
Between: AutoFix Workshop & Mike Johnson

1. Employment Relationship
   You are EMPLOYEE of AutoFix Workshop.
   Workshop employs you directly (not platform).
   Hours: Monday-Friday 9am-5pm
   Wage: $25/hour
   Benefits: [Health insurance, etc.]

2. Platform Use During Work Hours
   Workshop provides access to AskAutoDoctor platform.
   Sessions taken 9am-5pm are WORKSHOP BUSINESS.
   Revenue from work-hour sessions goes to Workshop.

   You authorize platform to route work-hour revenue to:
   Workshop Stripe Account: acct_xxxxx

3. Independent Work (Outside Hours)
   You may use platform independently after work hours.
   This is YOUR private business (not workshop's).
   Workshop [CHOOSES ONE]:
   ‚òê No geographic restrictions (full trust)
   ‚òë Geographic restriction: Toronto 50km radius

4. Non-Compete (If Geographic Restriction Enabled)
   During employment + 30 days after, you will not serve
   customers within Toronto 50km radius independently.

5. Termination
   Either party may terminate with 2 weeks notice.
   Upon termination, geographic restrictions lift after 30 days.

Signed: _________________ Date: _______
```

**Agreement 3: Platform ‚Üê‚Üí Workshop (Business Services)**

```
WORKSHOP SERVICES AGREEMENT

1. Relationship
   AutoFix Workshop is independent business.
   Platform provides marketplace service.
   No employment relationship.

2. Services
   Platform allows your employees to take sessions during work.
   Revenue routing: Sessions during work hours ‚Üí Your Stripe account.
   Platform takes 5% service fee.

3. Your Responsibilities
   - Employ mechanics directly (your employment relationship)
   - Maintain insurance and licenses
   - Comply with labor laws
   - Set wages and conditions

4. Platform's Role
   - Provide technology infrastructure
   - Process payments (5% fee)
   - Customer matching/routing
   - We do NOT: employ your workers, control conditions,
     set wages, supervise work

5. Privacy & Monitoring
   During work hours: You see full session details
   Outside work hours: Limited visibility (geographic verification only)
   Mechanic's independent earnings are private

6. Liability
   Platform is marketplace/broker only.
   We do not guarantee work quality.
   You maintain own liability insurance.
```

---

## üõ°Ô∏è CANADIAN LAW COMPLIANCE

### **Key Canadian Employment Law Considerations:**

**1. Independent Contractor vs Employee Test (CRA Criteria)**

```
Platform-Mechanic Relationship Analysis:

Control Test:
‚ùå Platform does NOT control how mechanic works ‚Üí Independent ‚úÖ
‚ùå Platform does NOT set schedule ‚Üí Independent ‚úÖ
‚ùå Platform does NOT supervise ‚Üí Independent ‚úÖ

Ownership of Tools:
‚úÖ Mechanic owns their account ‚Üí Independent ‚úÖ
‚úÖ Mechanic owns their equipment ‚Üí Independent ‚úÖ

Chance of Profit/Loss:
‚úÖ Mechanic's income varies ‚Üí Independent ‚úÖ
‚úÖ Mechanic can refuse work ‚Üí Independent ‚úÖ

Integration:
‚úÖ Mechanic can work for multiple platforms ‚Üí Independent ‚úÖ
‚úÖ Mechanic has other clients ‚Üí Independent ‚úÖ

RESULT: Mechanics are INDEPENDENT CONTRACTORS (not employees)
```

**2. Workshop-Mechanic Relationship**

```
Workshop-Mechanic Analysis:

Control Test:
‚úÖ Workshop sets schedule (9am-5pm) ‚Üí Employee ‚úÖ
‚úÖ Workshop supervises work ‚Üí Employee ‚úÖ

Payment:
‚úÖ Hourly wage ($25/hr) ‚Üí Employee ‚úÖ
‚úÖ Regular pay periods ‚Üí Employee ‚úÖ

Benefits:
‚úÖ Workshop may provide benefits ‚Üí Employee ‚úÖ

RESULT: Workshop mechanics are EMPLOYEES of workshop
(not platform, not contractors)

Workshop must:
- Issue T4 tax forms
- Deduct CPP, EI, income tax
- Maintain WSIB coverage
- Comply with ESA (Employment Standards Act)
```

**3. Privacy Law Compliance (PIPEDA)**

```
Personal Information Protection:

Mechanic's Independent Earnings:
‚úÖ Platform does NOT share with workshop (privacy protected)
‚úÖ Workshop has NO legitimate need to know
‚úÖ Mechanic's independent business is separate

Mechanic's Work-Hour Sessions:
‚úÖ Workshop CAN see (legitimate business need)
‚úÖ Workshop owns this data (it's their business)

Geographic Verification:
‚úÖ Workshop can see CITY NAMES only (not customer details)
‚úÖ Minimal data for legitimate purpose (non-compete)
```

**4. Competition Law Considerations**

```
Non-Compete Enforceability in Canada:

Geographic Restriction (Toronto 50km):
‚úÖ Limited in scope (50km, not all Canada) ‚Üí Valid ‚úÖ
‚úÖ Limited in time (during employment + 30 days) ‚Üí Valid ‚úÖ
‚úÖ Protects legitimate interest (customer territory) ‚Üí Valid ‚úÖ
‚úÖ Mechanic can still work (85% of market available) ‚Üí Valid ‚úÖ

Recent Changes (June 2023):
‚ùå Ontario banned non-competes for employees BUT
‚úÖ Exception: Sale of business or executive roles
‚úÖ Non-solicitation still allowed (can't steal customers)

SAFER APPROACH: Use "non-solicitation" not "non-compete"
"You will not actively solicit customers within Toronto 50km"
vs
"You cannot serve customers within Toronto 50km"
```

---

## üéõÔ∏è WORKSHOP CONTROL SETTINGS

### **Workshop Chooses Their Own Policy:**

```
Workshop Settings - Employee Integration

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Mike Johnson - Employment Settings                  ‚îÇ
‚îÇ                                                     ‚îÇ
‚îÇ Work Schedule:                                     ‚îÇ
‚îÇ ‚òë Monday-Friday 9:00 AM - 5:00 PM                  ‚îÇ
‚îÇ ‚òê Custom schedule (set specific hours)             ‚îÇ
‚îÇ                                                     ‚îÇ
‚îÇ After-Hours Policy (Mike's Independent Work):      ‚îÇ
‚îÇ                                                     ‚îÇ
‚îÇ Choose your preference:                            ‚îÇ
‚îÇ                                                     ‚îÇ
‚îÇ ‚óã Full Trust Mode (Recommended for loyal employees)‚îÇ
‚îÇ   ‚úì No geographic restrictions                     ‚îÇ
‚îÇ   ‚úì Mike can serve any customer after hours        ‚îÇ
‚îÇ   ‚úì Good mechanics bring customers to your shop    ‚îÇ
‚îÇ   ‚úì Builds employee loyalty and trust              ‚îÇ
‚îÇ                                                     ‚îÇ
‚îÇ ‚óè Protected Territory Mode (Default)               ‚îÇ
‚îÇ   ‚úì Block customers within: [50] km radius         ‚îÇ
‚îÇ   ‚úì Mike can work anywhere else in Canada          ‚îÇ
‚îÇ   ‚úì Protects your local customer base              ‚îÇ
‚îÇ   ‚úì Mike can still earn good income                ‚îÇ
‚îÇ                                                     ‚îÇ
‚îÇ ‚óã Strict Mode (For new/untrusted employees)        ‚îÇ
‚îÇ   ‚úì Block entire province/region                   ‚îÇ
‚îÇ   ‚úì Mike can only serve distant customers          ‚îÇ
‚îÇ   ‚úì Maximum protection, lower Mike's income        ‚îÇ
‚îÇ                                                     ‚îÇ
‚îÇ Monitoring Preferences:                            ‚îÇ
‚îÇ ‚òë Alert me if geographic violations detected       ‚îÇ
‚îÇ ‚òë Show me session count (not revenue amounts)      ‚îÇ
‚îÇ ‚òê Show me customer cities for verification         ‚îÇ
‚îÇ                                                     ‚îÇ
‚îÇ [Save Settings]                                    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### **Why This Flexibility Matters:**

**Scenario 1: Loyal, Trusted Employee (Full Trust Mode)**

```
Workshop Owner thinks:
"Mike has worked for me for 5 years. He's honest and brings
customers to the shop when they need physical work. I trust him
to do independent work locally. No restrictions."

Benefits:
- Mike earns maximum income (happy employee)
- Mike sends physical work to workshop (extra revenue)
- Strong loyalty (employee feels trusted)
```

**Scenario 2: New Employee (Protected Territory Mode)**

```
Workshop Owner thinks:
"Mike just started. He seems good, but I don't know him well yet.
I'll protect my Toronto territory for now. He can still earn
good money in other cities."

Benefits:
- Workshop territory protected
- Mike can still earn independently (not blocked completely)
- Fair balance of interests
```

**Scenario 3: Bad Actor History (Strict Mode)**

```
Workshop Owner thinks:
"Mike was caught stealing customers before. I'll hire him but
block the entire province. He can work in other provinces only."

Benefits:
- Maximum protection
- Clear boundaries
- Mike still has income potential (rest of Canada)
```

---

## üíª TECHNICAL IMPLEMENTATION

### **Database Schema (Privacy-Compliant)**

```sql
-- Mechanics table (Account Owner)
CREATE TABLE mechanics (
  id UUID PRIMARY KEY,
  user_id UUID REFERENCES auth.users(id) NOT NULL,
  name VARCHAR(255),
  stripe_account_id VARCHAR(255), -- Mike's personal Stripe
  -- Workshop integration (optional)
  workshop_integrations JSONB DEFAULT '[]'::jsonb,
  created_at TIMESTAMP DEFAULT NOW()
);

-- Workshop integrations (separate from ownership)
CREATE TABLE workshop_integrations (
  id UUID PRIMARY KEY,
  mechanic_id UUID REFERENCES mechanics(id) NOT NULL,
  workshop_id UUID REFERENCES workshops(id) NOT NULL,

  -- Schedule
  work_days JSONB, -- ["monday", "tuesday", ...]
  work_start_time TIME, -- '09:00:00'
  work_end_time TIME,   -- '17:00:00'

  -- Workshop's policy choice
  geographic_restriction_mode VARCHAR(50) CHECK (
    geographic_restriction_mode IN ('none', 'radius', 'province', 'custom')
  ),
  restriction_postal_code VARCHAR(10),
  restriction_radius_km INTEGER,

  -- Privacy settings
  workshop_can_see_independent_revenue BOOLEAN DEFAULT FALSE, -- Always false for privacy
  workshop_can_see_independent_count BOOLEAN DEFAULT TRUE,
  workshop_can_see_customer_cities BOOLEAN DEFAULT TRUE, -- For verification only

  -- Employment status
  employment_status VARCHAR(50) DEFAULT 'active',
  employment_start_date DATE,
  employment_end_date DATE,
  cooling_period_days INTEGER DEFAULT 30,

  created_at TIMESTAMP DEFAULT NOW(),
  UNIQUE(mechanic_id, workshop_id)
);

-- Session revenue routing
CREATE TABLE session_payments (
  id UUID PRIMARY KEY,
  session_id UUID REFERENCES session_requests(id),

  -- Payment destination
  recipient_type VARCHAR(50) CHECK (recipient_type IN ('mechanic', 'workshop')),
  recipient_stripe_account_id VARCHAR(255),

  -- Amounts
  session_fee DECIMAL(10,2),
  platform_fee DECIMAL(10,2),
  recipient_amount DECIMAL(10,2),

  -- Context (for auditing only)
  was_during_workshop_hours BOOLEAN,
  workshop_integration_id UUID REFERENCES workshop_integrations(id),

  -- Privacy: Store city for verification, NOT full address
  customer_city VARCHAR(100), -- For geographic verification
  customer_postal_code_fsa VARCHAR(3), -- First 3 digits only

  created_at TIMESTAMP DEFAULT NOW()
);
```

### **Revenue Routing Logic (Privacy-Preserving)**

```typescript
async function routeSessionPayment(
  sessionId: string,
  mechanicId: string,
  customerPostalCode: string,
  sessionFee: number
) {
  const mechanic = await getMechanic(mechanicId)
  const now = new Date()

  // Check if mechanic is currently in workshop hours
  const activeIntegration = await getActiveWorkshopIntegration(mechanicId, now)

  if (activeIntegration && isDuringWorkHours(activeIntegration, now)) {
    // WORKSHOP MODE: Route to workshop

    // Check geographic restriction (workshop may have enabled)
    if (activeIntegration.geographic_restriction_mode !== 'none') {
      const isInRestrictedZone = checkGeographicRestriction(
        customerPostalCode,
        activeIntegration
      )

      if (isInRestrictedZone) {
        throw new Error('Customer in restricted zone - workshop policy')
      }
    }

    // Route to workshop's Stripe account
    return {
      recipient_type: 'workshop',
      recipient_stripe_account_id: activeIntegration.workshop.stripe_account_id,
      recipient_amount: sessionFee * 0.95,
      platform_fee: sessionFee * 0.05,
      was_during_workshop_hours: true,

      // Store city for workshop visibility (NOT customer name/details)
      customer_city: extractCityFromPostalCode(customerPostalCode),
      customer_postal_code_fsa: customerPostalCode.substring(0, 3)
    }

  } else {
    // INDEPENDENT MODE: Route to mechanic

    // Check if mechanic has workshop integration with restrictions
    const anyIntegration = await getAnyActiveWorkshopIntegration(mechanicId)

    if (anyIntegration && anyIntegration.geographic_restriction_mode !== 'none') {
      const isInRestrictedZone = checkGeographicRestriction(
        customerPostalCode,
        anyIntegration
      )

      if (isInRestrictedZone) {
        // Log violation but don't show to workshop (privacy)
        await logGeographicViolation(mechanicId, anyIntegration.id, customerPostalCode)
        throw new Error('Customer in restricted zone per employment agreement')
      }
    }

    // Route to mechanic's personal Stripe account
    return {
      recipient_type: 'mechanic',
      recipient_stripe_account_id: mechanic.stripe_account_id,
      recipient_amount: sessionFee * 0.95,
      platform_fee: sessionFee * 0.05,
      was_during_workshop_hours: false,

      // Store city for verification (workshop can see city, not revenue)
      customer_city: extractCityFromPostalCode(customerPostalCode),
      customer_postal_code_fsa: customerPostalCode.substring(0, 3)
    }
  }
}
```

### **Workshop Dashboard Query (Privacy-Compliant)**

```typescript
async function getWorkshopDashboardData(workshopId: string) {
  // Workshop mode sessions (full details - it's their business)
  const workshopSessions = await db.query(`
    SELECT
      s.id,
      s.customer_name,
      s.vehicle_info,
      s.issue_description,
      p.session_fee,
      p.recipient_amount,
      p.created_at,
      m.name as mechanic_name
    FROM session_payments p
    JOIN session_requests s ON p.session_id = s.id
    JOIN mechanics m ON s.mechanic_id = m.id
    WHERE p.recipient_type = 'workshop'
      AND p.workshop_integration_id IN (
        SELECT id FROM workshop_integrations WHERE workshop_id = $1
      )
      AND p.created_at > NOW() - INTERVAL '7 days'
  `, [workshopId])

  // Independent sessions (privacy-protected - counts and cities only)
  const independentActivity = await db.query(`
    SELECT
      m.id as mechanic_id,
      m.name as mechanic_name,
      COUNT(*) as session_count,
      ARRAY_AGG(DISTINCT p.customer_city) as cities_served,
      -- NO revenue amounts (privacy)
      SUM(CASE
        WHEN is_geographic_violation(p.customer_postal_code_fsa, wi.restriction_postal_code, wi.restriction_radius_km)
        THEN 1 ELSE 0
      END) as violation_count
    FROM session_payments p
    JOIN session_requests s ON p.session_id = s.id
    JOIN mechanics m ON s.mechanic_id = m.id
    JOIN workshop_integrations wi ON wi.mechanic_id = m.id
    WHERE p.recipient_type = 'mechanic'
      AND p.was_during_workshop_hours = FALSE
      AND wi.workshop_id = $1
      AND wi.employment_status = 'active'
      AND p.created_at > NOW() - INTERVAL '7 days'
    GROUP BY m.id, m.name
  `, [workshopId])

  return {
    workshop_sessions: workshopSessions, // Full details
    independent_activity: independentActivity.map(row => ({
      mechanic_id: row.mechanic_id,
      mechanic_name: row.mechanic_name,
      session_count: row.session_count, // Count only, no revenue
      cities_served: row.cities_served, // For verification
      violations: row.violation_count
      // NO revenue_amount (privacy protected)
    }))
  }
}
```

---

## üìä REVENUE REPORTING (Tax Compliance)

### **Platform's Tax Reporting Obligations:**

```
End of Tax Year (December 31):

Platform Issues:

1. To Mechanics (T4A - Independent Contractor Income)
   - Total session revenue paid to mechanic
   - Includes BOTH independent sessions AND workshop-hour sessions
     that went to mechanic
   - CRA reporting requirement

2. To Workshops (T4A - Business Income)
   - Total session revenue paid to workshop
   - Sessions taken by workshop's employees during work hours
   - CRA reporting requirement

3. To CRA (Information Returns)
   - Report all T4A recipients
   - Platform's role: Payment processor/broker

NOTE: Platform does NOT report mechanic-workshop employment
relationship. That's between workshop and mechanic.
```

### **Workshop's Tax Obligations (Separate):**

```
Workshop Must Issue to Mechanic:

1. T4 (Employment Income)
   - Hourly wage paid ($25/hr √ó hours worked)
   - CPP, EI, income tax deductions
   - This is separate from platform payments

Mechanic's Total Tax Picture:
- T4 from Workshop: Employment income (hourly wage)
- T4A from Platform: Independent contractor income
- Both reported separately on personal tax return
```

---

## ‚öñÔ∏è LIABILITY PROTECTION

### **Platform Terms of Service (Key Clauses):**

```
ASKAUTODOCTOR TERMS OF SERVICE

1. MARKETPLACE SERVICE ONLY

AskAutoDoctor is a technology platform that connects customers
with independent automotive service providers (mechanics and workshops).

We do NOT:
- Employ mechanics or workshops
- Control how services are performed
- Guarantee quality of services
- Provide automotive services ourselves

We provide:
- Technology infrastructure
- Payment processing
- Customer matching
- Communication tools

2. INDEPENDENT CONTRACTOR RELATIONSHIP

All mechanics and workshops are independent contractors.
You maintain your own:
- Business licenses and insurance
- Liability coverage
- Professional certifications
- Tax obligations

3. WORKSHOP-MECHANIC RELATIONSHIPS

Any employment relationship between workshops and mechanics
is separate from platform. Platform is not party to such
employment agreements.

Workshop responsibilities:
- Compliance with employment laws
- Worker's compensation coverage
- Payroll taxes and deductions
- Employment standards compliance

4. LIMITATION OF LIABILITY

Platform liability limited to service fees paid.
We are not liable for:
- Work quality or accuracy
- Employment disputes
- Labor law violations by workshops
- Tax obligations of users

5. INDEMNIFICATION

Users agree to indemnify platform for:
- Any employment claims
- Professional negligence claims
- Tax disputes
- License/insurance violations

6. DISPUTE RESOLUTION

Disputes between workshops and mechanics are separate
from platform. Platform may suspend accounts but is not
arbitrator of employment matters.
```

---

## ‚úÖ FINAL RECOMMENDATIONS

### **1. Workshop Control Settings:**

```typescript
// Workshop chooses their policy
const workshopPolicies = {
  full_trust: {
    geographic_restriction: false,
    monitoring: 'minimal', // Count only
    benefits: 'Employee loyalty, potential referrals'
  },

  protected_territory: {
    geographic_restriction: true,
    radius_km: 50, // Workshop chooses 25-100km
    monitoring: 'verification', // Cities for verification
    benefits: 'Balanced protection and employee income'
  },

  strict: {
    geographic_restriction: true,
    radius_km: 200, // Entire province
    monitoring: 'full', // All cities tracked
    benefits: 'Maximum protection'
  }
}
```

### **2. Privacy Protection:**

```
What Workshop Sees:
‚úÖ Work-hour sessions: Full details (customer name, issue, revenue)
‚úÖ Independent sessions: Count + cities (for verification)
‚ùå Independent sessions: Revenue amounts (privacy protected)
‚ùå Independent sessions: Customer names/details

Mechanic Controls:
‚úÖ Owns their account
‚úÖ Can disconnect from workshop
‚úÖ Independent earnings private
‚úÖ Can have multiple workshop integrations
```

### **3. Legal Compliance Checklist:**

```
‚úÖ Mechanics are independent contractors (pass CRA test)
‚úÖ Workshops employ mechanics directly (not platform)
‚úÖ Platform = broker/marketplace only
‚úÖ Privacy law compliant (PIPEDA)
‚úÖ Tax reporting compliant (T4A issuance)
‚úÖ Non-compete limited and reasonable
‚úÖ Terms of service protect platform liability
‚úÖ Insurance requirements clear
```

### **4. Implementation Priority:**

```
Phase 1: Basic Dual Mode (2-3 weeks)
- Account ownership (mechanic owns)
- Time-based revenue routing
- Workshop dashboard (work-hour sessions)
- Privacy-protected independent view

Phase 2: Geographic Controls (1-2 weeks)
- Workshop chooses policy (trust/protected/strict)
- Geographic filtering
- Violation detection
- City-level verification

Phase 3: Legal Compliance (1 week)
- Updated Terms of Service
- T4A reporting system
- Insurance verification
- Agreement templates

Phase 4: Advanced Features (2-3 weeks)
- Multiple workshop integrations
- Schedule flexibility
- Cooling period automation
- Analytics and reporting
```

---

## üéâ FINAL ANSWER TO YOUR QUESTIONS

### **Q: Should workshop control city restrictions?**
‚úÖ **YES.** Workshop chooses: Full Trust / Protected Territory / Strict
Different workshops have different risk tolerance and employee relationships.

### **Q: Can workshop see mechanic's independent revenue?**
‚ùå **NO.** Privacy protected. Workshop sees:
- Work-hour revenue (full details - it's their business)
- Independent count + cities (verification only)
- NO independent revenue amounts

### **Q: Who owns the account?**
‚úÖ **MECHANIC OWNS.** Always. This is critical for:
- Independent contractor status (legal requirement)
- Privacy protection (mechanic's right)
- Platform liability protection (not employer)

### **Q: Is this legal in Canada?**
‚úÖ **YES.** With proper structure:
- Mechanics = independent contractors of platform ‚úÖ
- Mechanics = employees of workshop (workshop's responsibility) ‚úÖ
- Platform = broker only (no employment relationship) ‚úÖ
- Privacy compliant (PIPEDA) ‚úÖ
- Tax compliant (T4A reporting) ‚úÖ

### **Q: Platform liability?**
‚úÖ **MINIMAL.** Platform is marketplace/broker:
- No employment relationship
- No control over work
- Clear Terms of Service
- Users maintain own insurance

---

**This is the final, legal-compliant, practical solution. Ready to implement?**
